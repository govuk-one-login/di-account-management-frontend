import { Request, Response } from "express";
import { Buffer } from "buffer";
import { getTxmaHeader } from "../../utils/txma-header";

export function deviceInformationGet(req: Request, res: Response): void {
  const deviceHeader = getTxmaHeader(req, res.locals.trace);
  //const deviceHeader =
  //  "eyJoYXJkd2FyZSI6eyJ2aWRlb2NhcmQiOnsidmVuZG9yIjoiV2ViS2l0IiwicmVuZGVyZXIiOiJXZWJLaXQgV2ViR0wiLCJ2ZXJzaW9uIjoiV2ViR0wgMS4wIChPcGVuR0wgRVMgMi4wIENocm9taXVtKSIsInNoYWRpbmdMYW5ndWFnZVZlcnNpb24iOiJXZWJHTCBHTFNMIEVTIDEuMCAoT3BlbkdMIEVTIEdMU0wgRVMgMS4wIENocm9taXVtKSJ9LCJhcmNoaXRlY3R1cmUiOjI1NSwiZGV2aWNlTWVtb3J5IjoiOCIsImpzSGVhcFNpemVMaW1pdCI6NDI5NDcwNTE1Mn0sImxvY2FsZXMiOnsibGFuZ3VhZ2VzIjoiZW4tR0IiLCJ0aW1lem9uZSI6IkV1cm9wZS9Mb25kb24ifSwicGVybWlzc2lvbnMiOnsiYWNjZWxlcm9tZXRlciI6ImdyYW50ZWQiLCJiYWNrZ3JvdW5kLWZldGNoIjoiZ3JhbnRlZCIsImJhY2tncm91bmQtc3luYyI6ImdyYW50ZWQiLCJjYW1lcmEiOiJwcm9tcHQiLCJjbGlwYm9hcmQtcmVhZCI6InByb21wdCIsImNsaXBib2FyZC13cml0ZSI6ImdyYW50ZWQiLCJkaXNwbGF5LWNhcHR1cmUiOiJwcm9tcHQiLCJneXJvc2NvcGUiOiJncmFudGVkIiwiZ2VvbG9jYXRpb24iOiJwcm9tcHQiLCJsb2NhbC1mb250cyI6InByb21wdCIsIm1hZ25ldG9tZXRlciI6ImdyYW50ZWQiLCJtaWNyb3Bob25lIjoicHJvbXB0IiwibWlkaSI6InByb21wdCIsIm5vdGlmaWNhdGlvbnMiOiJkZW5pZWQiLCJwYXltZW50LWhhbmRsZXIiOiJncmFudGVkIiwicGVyc2lzdGVudC1zdG9yYWdlIjoicHJvbXB0Iiwic3RvcmFnZS1hY2Nlc3MiOiJncmFudGVkIiwid2luZG93LW1hbmFnZW1lbnQiOiJwcm9tcHQifSwicGx1Z2lucyI6eyJwbHVnaW5zIjpbIlBERiBWaWV3ZXJ8aW50ZXJuYWwtcGRmLXZpZXdlcnxQb3J0YWJsZSBEb2N1bWVudCBGb3JtYXQiLCJDaHJvbWUgUERGIFZpZXdlcnxpbnRlcm5hbC1wZGYtdmlld2VyfFBvcnRhYmxlIERvY3VtZW50IEZvcm1hdCIsIkNocm9taXVtIFBERiBWaWV3ZXJ8aW50ZXJuYWwtcGRmLXZpZXdlcnxQb3J0YWJsZSBEb2N1bWVudCBGb3JtYXQiLCJNaWNyb3NvZnQgRWRnZSBQREYgVmlld2VyfGludGVybmFsLXBkZi12aWV3ZXJ8UG9ydGFibGUgRG9jdW1lbnQgRm9ybWF0IiwiV2ViS2l0IGJ1aWx0LWluIFBERnxpbnRlcm5hbC1wZGYtdmlld2VyfFBvcnRhYmxlIERvY3VtZW50IEZvcm1hdCJdfSwic2NyZWVuIjp7ImlzX3RvdWNoc2NyZWVuIjpmYWxzZSwibWF4VG91Y2hQb2ludHMiOjAsImNvbG9yRGVwdGgiOjI0LCJtZWRpYU1hdGNoZXMiOlsicHJlZmVycy1jb250cmFzdDogbm8tcHJlZmVyZW5jZSIsImFueS1ob3ZlcjogaG92ZXIiLCJhbnktcG9pbnRlcjogZmluZSIsInBvaW50ZXI6IGZpbmUiLCJob3ZlcjogaG92ZXIiLCJ1cGRhdGU6IGZhc3QiLCJwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiBuby1wcmVmZXJlbmNlIiwicHJlZmVycy1yZWR1Y2VkLXRyYW5zcGFyZW5jeTogbm8tcHJlZmVyZW5jZSIsInNjcmlwdGluZzogZW5hYmxlZCIsImZvcmNlZC1jb2xvcnM6IG5vbmUiXX0sInN5c3RlbSI6eyJwbGF0Zm9ybSI6Ik1hY0ludGVsIiwiY29va2llRW5hYmxlZCI6dHJ1ZSwicHJvZHVjdFN1YiI6IjIwMDMwMTA3IiwicHJvZHVjdCI6IkdlY2tvIiwidXNlcmFnZW50IjoiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzE0MC4wLjAuMCBTYWZhcmkvNTM3LjM2IiwiaGFyZHdhcmVDb25jdXJyZW5jeSI6NiwiYnJvd3NlciI6eyJuYW1lIjoiQ2hyb21lIiwidmVyc2lvbiI6IjE0MC4wIn0sImFwcGxlUGF5VmVyc2lvbiI6MH0sImZvbnRzIjp7ImZvbnRIYXNoIjoiN2Y1M2MzOTZiODg1NWZhN2M0MWMyZDZhYzQ3MzZlZDkifSwidGh1bWJtYXJrIjp7ImRldmljZUhhc2giOiJhZTk5YzAzMzNhZmYxZGFlNWNjMjY3YzIxMzRkMTZkZSJ9fQ==";
  if (deviceHeader) {
    const decoded = JSON.parse(
      Buffer.from(deviceHeader, "base64").toString("utf-8")
    );
    res.json({
      decodedDeviceInfo: decoded,
    });
  }
}
